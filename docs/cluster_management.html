

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setting up a Cluster &mdash; Rally 2.0.4.dev0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tips and Tricks" href="recipes.html" />
    <link rel="prev" title="Compare Results: Tournaments" href="tournament.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Rally
          

          
          </a>

          
            
            
              <div class="version">
                2.0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started with Rally</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Running Rally with Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="race.html">Run a Benchmark: Races</a></li>
<li class="toctree-l1"><a class="reference internal" href="tournament.html">Compare Results: Tournaments</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Setting up a Cluster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-started-benchmarking-a-single-node">Getting Started: Benchmarking a Single Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="#levelling-up-benchmarking-a-cluster">Levelling Up: Benchmarking a Cluster</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Tips and Tricks</a></li>
</ul>
<p class="caption"><span class="caption-text">Extending Rally</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="adding_tracks.html">Define Custom Workloads: Tracks</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing.html">Developing Rally</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="versions.html">Elasticsearch Version Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line_reference.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="offline.html">Offline Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="track.html">Track Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="car.html">Configure Elasticsearch: Cars</a></li>
<li class="toctree-l1"><a class="reference internal" href="elasticsearch_plugins.html">Using Elasticsearch Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="telemetry.html">Telemetry Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="rally_daemon.html">Rally Daemon</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipelines.html">Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="summary_report.html">Summary Report</a></li>
</ul>
<p class="caption"><span class="caption-text">Additional Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="migrate.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">Community Resources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rally</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
















<div role="navigation" aria-label="breadcrumbs navigation">

    <ul class="wy-breadcrumbs">
        
        <li><a href="index.html">Docs</a> &raquo;</li>
        
        <li>Setting up a Cluster</li>
        
        
        <li class="wy-breadcrumbs-aside">
            
            
            <a href="_sources/cluster_management.rst.txt" rel="nofollow"> View page source</a>
            
            
        </li>
        
    </ul>

    
    <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="setting-up-a-cluster">
<h1>Setting up a Cluster<a class="headerlink" href="#setting-up-a-cluster" title="Permalink to this headline">¶</a></h1>
<p>In this section we cover how to setup an Elasticsearch cluster with Rally. It is by no means required to use Rally for this and you can also use existing tooling like Ansible to achieve the same goal. The main difference between standard tools and Rally is that Rally is capable of setting up a <a class="reference internal" href="versions.html"><span class="doc">wide range of Elasticsearch versions</span></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The following functionality is experimental. Expect the functionality and the command line interface to change significantly even in patch releases.</p>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>You can use the following subcommands in Rally to manage Elasticsearch nodes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">install</span></code> to install a single Elasticsearch node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> to start a previously installed Elasticsearch node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop</span></code> to stop a running Elasticsearch node and remove the installation</p></li>
</ul>
<p>Each command needs to be executed locally on the machine where the Elasticsearch node should run. To setup more complex clusters remotely, we recommend using a tool like Ansible to connect to remote machines and issue these commands via Rally.</p>
</div>
<div class="section" id="getting-started-benchmarking-a-single-node">
<h2>Getting Started: Benchmarking a Single Node<a class="headerlink" href="#getting-started-benchmarking-a-single-node" title="Permalink to this headline">¶</a></h2>
<p>In this section we will setup a single Elasticsearch node locally, run a benchmark and then cleanup.</p>
<p>First we need to install Elasticearch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">esrally</span> <span class="n">install</span> <span class="o">--</span><span class="n">quiet</span> <span class="o">--</span><span class="n">distribution</span><span class="o">-</span><span class="n">version</span><span class="o">=</span><span class="mf">7.4</span><span class="o">.</span><span class="mi">2</span> <span class="o">--</span><span class="n">node</span><span class="o">-</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;rally-node-0&quot;</span> <span class="o">--</span><span class="n">network</span><span class="o">-</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span> <span class="o">--</span><span class="n">http</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">39200</span> <span class="o">--</span><span class="n">master</span><span class="o">-</span><span class="n">nodes</span><span class="o">=</span><span class="s2">&quot;rally-node-0&quot;</span> <span class="o">--</span><span class="n">seed</span><span class="o">-</span><span class="n">hosts</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:39300&quot;</span>
</pre></div>
</div>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">--network-host</span></code> defines the network interface this node will bind to and <code class="docutils literal notranslate"><span class="pre">--http-port</span></code> defines which port will be exposed for HTTP traffic. Rally will automatically choose the transport port range as 100 above (39300). The parameters <code class="docutils literal notranslate"><span class="pre">--master-nodes</span></code> and <code class="docutils literal notranslate"><span class="pre">--seed-hosts</span></code> are necessary for the discovery process. Please see the respective Elasticsearch documentation on <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery.html">discovery</a> for more details.</p>
<p>This produces the following output (the value will vary for each invocation):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;installation-id&quot;</span><span class="p">:</span> <span class="s2">&quot;69ffcfee-6378-4090-9e93-87c9f8ee59a7&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We will need the installation id in the next steps to refer to our current installation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can extract the installation id value with <a class="reference external" href="https://stedolan.github.io/jq/">jq</a> with the following command: <code class="docutils literal notranslate"><span class="pre">jq</span> <span class="pre">--raw-output</span> <span class="pre">'.[&quot;installation-id&quot;]'</span></code>.</p>
</div>
<p>After installation, we can start the node. To tie all metrics of a benchmark together, Rally needs a consistent race id across all invocations. The format of the race id does not matter but we suggest using UUIDs. You can generate a UUID on the command line with <code class="docutils literal notranslate"><span class="pre">uuidgen</span></code>. Issue the following command to start the node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># generate a unique race id (use the same id from now on)
export RACE_ID=$(uuidgen)
esrally start --installation-id=&quot;69ffcfee-6378-4090-9e93-87c9f8ee59a7&quot; --race-id=&quot;${RACE_ID}&quot;
</pre></div>
</div>
<p>After the Elasticsearch node has started, we can run a benchmark. Be sure to pass the same race id so you can match results later in your metrics store:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>esrally --pipeline=benchmark-only --target-host=127.0.0.1:39200 --track=geonames --challenge=append-no-conflicts-index-only --on-error=abort --race-id=${RACE_ID}
</pre></div>
</div>
<p>When the benchmark has finished, we can stop the node again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">esrally</span> <span class="n">stop</span> <span class="o">--</span><span class="n">installation</span><span class="o">-</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;69ffcfee-6378-4090-9e93-87c9f8ee59a7&quot;</span>
</pre></div>
</div>
<p>If you only want to shutdown the node but don’t want to delete the node and the data, pass <code class="docutils literal notranslate"><span class="pre">--preserve-install</span></code> additionally.</p>
</div>
<div class="section" id="levelling-up-benchmarking-a-cluster">
<h2>Levelling Up: Benchmarking a Cluster<a class="headerlink" href="#levelling-up-benchmarking-a-cluster" title="Permalink to this headline">¶</a></h2>
<p>This approach of being able to manage individual cluster nodes shows its power when we want to setup a cluster consisting of multiple nodes. At the moment Rally only supports a uniform cluster architecture but with this approach we can also setup arbitrarily complex clusters. The following examples shows how to setup a uniform three node cluster on three machines with the IPs <code class="docutils literal notranslate"><span class="pre">192.168.14.77</span></code>, <code class="docutils literal notranslate"><span class="pre">192.168.14.78</span></code> and <code class="docutils literal notranslate"><span class="pre">192.168.14.79</span></code>. On each machine we will issue the following command (pick the right one per machine):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># on 192.168.14.77
export INSTALLATION_ID=$(esrally install --quiet --distribution-version=7.4.2 --node-name=&quot;rally-node-0&quot; --network-host=&quot;192.168.14.77&quot; --http-port=39200 --master-nodes=&quot;rally-node-0,rally-node-1,rally-node-2&quot; --seed-hosts=&quot;192.168.14.77:39300,192.168.14.78:39300,192.168.14.79:39300&quot; | jq --raw-output &#39;.[&quot;installation-id&quot;]&#39;)
# on 192.168.14.78
export INSTALLATION_ID=$(esrally install --quiet --distribution-version=7.4.2 --node-name=&quot;rally-node-1&quot; --network-host=&quot;192.168.14.78&quot; --http-port=39200 --master-nodes=&quot;rally-node-0,rally-node-1,rally-node-2&quot; --seed-hosts=&quot;192.168.14.77:39300,192.168.14.78:39300,192.168.14.79:39300&quot; | jq --raw-output &#39;.[&quot;installation-id&quot;]&#39;)
# on 192.168.14.79
export INSTALLATION_ID=$(esrally install --quiet --distribution-version=7.4.2 --node-name=&quot;rally-node-2&quot; --network-host=&quot;192.168.14.79&quot; --http-port=39200 --master-nodes=&quot;rally-node-0,rally-node-1,rally-node-2&quot; --seed-hosts=&quot;192.168.14.77:39300,192.168.14.78:39300,192.168.14.79:39300&quot; | jq --raw-output &#39;.[&quot;installation-id&quot;]&#39;)
</pre></div>
</div>
<p>Then we pick a random race id, e.g. <code class="docutils literal notranslate"><span class="pre">fb38013d-5d06-4b81-b81a-b61c8c10f6e5</span></code> and set it on each machine (including the machine where will generate load):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">RACE_ID</span><span class="o">=</span><span class="s2">&quot;fb38013d-5d06-4b81-b81a-b61c8c10f6e5&quot;</span>
</pre></div>
</div>
<p>Now we can start the cluster. Run the following command on each node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">esrally</span> <span class="n">start</span> <span class="o">--</span><span class="n">installation</span><span class="o">-</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{INSTALLATION_ID}</span><span class="s2">&quot;</span> <span class="o">--</span><span class="n">race</span><span class="o">-</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{RACE_ID}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Once this has finished, we can check that the cluster is up and running e.g. with the <code class="docutils literal notranslate"><span class="pre">_cat/health</span></code> API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl http://192.168.14.77:39200/_cat/health\?v
</pre></div>
</div>
<p>We should see that our cluster consisting of three nodes is up and running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">epoch</span>      <span class="n">timestamp</span> <span class="n">cluster</span>         <span class="n">status</span> <span class="n">node</span><span class="o">.</span><span class="n">total</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span> <span class="n">shards</span> <span class="n">pri</span> <span class="n">relo</span> <span class="n">init</span> <span class="n">unassign</span> <span class="n">pending_tasks</span> <span class="n">max_task_wait_time</span> <span class="n">active_shards_percent</span>
<span class="mi">1574930657</span> <span class="mi">08</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">17</span>  <span class="n">rally</span><span class="o">-</span><span class="n">benchmark</span> <span class="n">green</span>           <span class="mi">3</span>         <span class="mi">3</span>      <span class="mi">0</span>   <span class="mi">0</span>    <span class="mi">0</span>    <span class="mi">0</span>        <span class="mi">0</span>             <span class="mi">0</span>                  <span class="o">-</span>                <span class="mf">100.0</span><span class="o">%</span>
</pre></div>
</div>
<p>Now we can start the benchmark on the load generator machine (remember to set the race id there):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>esrally --pipeline=benchmark-only --target-host=192.168.14.77:39200,192.168.14.78:39200,192.168.14.79:39200 --track=geonames --challenge=append-no-conflicts-index-only --on-error=abort --race-id=${RACE_ID}
</pre></div>
</div>
<p>Similarly to the single-node benchmark, we can now shutdown the cluster again by issuing the following command on each node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">esrally</span> <span class="n">stop</span> <span class="o">--</span><span class="n">installation</span><span class="o">-</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{INSTALLATION_ID}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="recipes.html" class="btn btn-neutral float-right" title="Tips and Tricks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tournament.html" class="btn btn-neutral float-left" title="Compare Results: Tournaments" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Elasticsearch B.V.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>